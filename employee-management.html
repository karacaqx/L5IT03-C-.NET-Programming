<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Employee Management - Employee Management System</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }

        .search-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .employee-details {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .employee-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            margin-bottom: 1rem;
        }
        
        .info-label {
            font-weight: 600;
            color: #6c757d;
            margin-bottom: 0.25rem;
        }
        
        .info-value {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            padding: 0.5rem;
            background: #f8f9fa;
            border-radius: 0.375rem;
        }
        
        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-weight: 600;
        }
        
        .status-active {
            background: #d1e7dd;
            color: #0a3622;
        }
        
        .status-inactive {
            background: #f8d7da;
            color: #58151c;
        }

        .fade-in {
            animation: fadeIn 0.8s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Department Themes */
        .theme-hr { --primary: #198754; --primary-dark: #157347; }
        .theme-it { --primary: #6f42c1; --primary-dark: #5a32a3; }
        .theme-finance { --primary: #fd7e14; --primary-dark: #e8590c; }
        .theme-marketing { --primary: #d63384; --primary-dark: #b02a5b; }
        .theme-default { --primary: #0d6efd; --primary-dark: #0b5ed7; }

        .themed .navbar { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%) !important; }
        .themed .btn-primary { background: var(--primary); border-color: var(--primary); }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="dashboard.html">
                <i class="fas fa-users me-2"></i>Employee Management
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.html">
                            <i class="fas fa-home me-1"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="employee-management.html">
                            <i class="fas fa-user-edit me-1"></i>Employee Management
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user me-1"></i>
                            <span id="userFullName">User</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" onclick="changeTheme()">
                                <i class="fas fa-palette me-1"></i>Change Theme
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="logout()">
                                <i class="fas fa-sign-out-alt me-1"></i>Logout
                            </a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <div class="fade-in">
            <!-- Page Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>
                    <i class="fas fa-users-cog me-2"></i>Employee Management
                </h2>
                <div>
                    <button class="btn btn-success me-2" onclick="showAddEmployeeForm()">
                        <i class="fas fa-plus me-1"></i>Add Employee
                    </button>
                    <button class="btn btn-outline-secondary" onclick="window.location.href='dashboard.html'">
                        <i class="fas fa-arrow-left me-1"></i>Back to Dashboard
                    </button>
                </div>
            </div>

            <!-- All Employees List Section -->
            <div id="allEmployeesList" class="mb-4" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4>
                        <i class="fas fa-users me-2"></i>All Employees
                    </h4>
                    <button class="btn btn-outline-secondary" onclick="hideAllEmployees()">
                        <i class="fas fa-times me-1"></i>Hide List
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header bg-light">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <span id="employeeCount" class="fw-bold">0 Employees Found</span>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-filter"></i>
                                    </span>
                                    <select id="departmentFilter" class="form-select" onchange="filterEmployees()">
                                        <option value="">All Departments</option>
                                        <option value="HR">Human Resources</option>
                                        <option value="IT">Information Technology</option>
                                        <option value="Finance">Finance</option>
                                        <option value="Marketing">Marketing</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Department</th>
                                        <th>Position</th>
                                        <th>Salary</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="allEmployeesTableBody">
                                    <!-- Employee data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Search Section -->
            <div class="search-section">
                <h4 class="mb-4">
                    <i class="fas fa-search me-2"></i>Search Employee
                </h4>
                
                <div class="row">
                    <div class="col-md-8">
                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="fas fa-id-badge"></i>
                            </span>
                            <input type="text" id="txtSearchEmployeeId" class="form-control" 
                                   placeholder="Enter Employee ID (e.g., EMP001)" maxlength="20">
                            <button class="btn btn-primary" onclick="searchEmployee()">
                                <i class="fas fa-search me-1"></i>Search
                            </button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-outline-secondary w-100" onclick="clearSearch()">
                            <i class="fas fa-times me-1"></i>Clear
                        </button>
                    </div>
                </div>
                
                <div id="searchMessage" class="alert mt-3" style="display: none;">
                    <span id="searchMessageText"></span>
                </div>
            </div>

            <!-- Employee Details Section -->
            <div id="employeeDetails" class="employee-details" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4>
                        <i class="fas fa-user me-2"></i>Employee Details
                    </h4>
                    <div>
                        <button id="btnEdit" class="btn btn-warning me-2" onclick="toggleEditMode()">
                            <i class="fas fa-edit me-1"></i>Edit
                        </button>
                        <button id="btnDelete" class="btn btn-danger me-2" onclick="showDeleteConfirmation()">
                            <i class="fas fa-trash me-1"></i>Delete
                        </button>
                        <button id="btnSave" class="btn btn-success me-2" onclick="saveEmployee()" style="display: none;">
                            <i class="fas fa-save me-1"></i>Save
                        </button>
                        <button id="btnCancel" class="btn btn-secondary" onclick="cancelEdit()" style="display: none;">
                            <i class="fas fa-times me-1"></i>Cancel
                        </button>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-3 text-center">
                        <div class="employee-avatar mx-auto" id="employeeAvatar">
                            JD
                        </div>
                        <div id="employeeStatus" class="status-badge status-active">
                            Active
                        </div>
                    </div>
                    
                    <div class="col-md-9">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="info-label">Employee ID</div>
                                <div class="info-value" id="employeeId">EMP001</div>
                                
                                <div class="info-label">First Name</div>
                                <div class="info-value">
                                    <span id="firstNameDisplay">John</span>
                                    <input type="text" id="firstNameEdit" class="form-control" style="display: none;">
                                </div>
                                
                                <div class="info-label">Last Name</div>
                                <div class="info-value">
                                    <span id="lastNameDisplay">Doe</span>
                                    <input type="text" id="lastNameEdit" class="form-control" style="display: none;">
                                </div>
                                
                                <div class="info-label">Email</div>
                                <div class="info-value">
                                    <span id="emailDisplay">john.doe@company.com</span>
                                    <input type="email" id="emailEdit" class="form-control" style="display: none;">
                                </div>
                                
                                <div class="info-label">Phone</div>
                                <div class="info-value">
                                    <span id="phoneDisplay">+1-555-0123</span>
                                    <input type="tel" id="phoneEdit" class="form-control" style="display: none;">
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="info-label">Department</div>
                                <div class="info-value">
                                    <span id="departmentDisplay">HR</span>
                                    <select id="departmentEdit" class="form-select" style="display: none;">
                                        <option value="HR">Human Resources</option>
                                        <option value="IT">Information Technology</option>
                                        <option value="Finance">Finance</option>
                                        <option value="Marketing">Marketing</option>
                                    </select>
                                </div>
                                
                                <div class="info-label">Position</div>
                                <div class="info-value">
                                    <span id="positionDisplay">HR Manager</span>
                                    <input type="text" id="positionEdit" class="form-control" style="display: none;">
                                </div>
                                
                                <div class="info-label">Salary</div>
                                <div class="info-value">
                                    <span id="salaryDisplay">$75,000</span>
                                    <input type="number" id="salaryEdit" class="form-control" style="display: none;">
                                </div>
                                
                                <div class="info-label">Hire Date</div>
                                <div class="info-value">
                                    <span id="hireDateDisplay">Jan 15, 2022</span>
                                    <input type="date" id="hireDateEdit" class="form-control" style="display: none;">
                                </div>
                                
                                <div class="info-label">Status</div>
                                <div class="info-value">
                                    <input type="checkbox" id="statusEdit" class="form-check-input me-2" style="display: none;">
                                    <label for="statusEdit" id="statusLabel" style="display: none;">Active Employee</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Update Message -->
            <div id="updateMessage" class="alert" style="display: none;">
                <span id="updateMessageText"></span>
            </div>
        </div>
    </div>

    <!-- Add Employee Modal -->
    <div class="modal fade" id="addEmployeeModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-user-plus me-2"></i>Add New Employee</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addEmployeeForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Employee ID *</label>
                                    <input type="text" id="newEmployeeId" class="form-control" placeholder="EMP006" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">First Name *</label>
                                    <input type="text" id="newFirstName" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Last Name *</label>
                                    <input type="text" id="newLastName" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Email *</label>
                                    <input type="email" id="newEmail" class="form-control" placeholder="john.doe@company.com" required>
                                    <small class="form-text text-muted">Enter a valid email address</small>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Phone</label>
                                    <input type="tel" id="newPhone" class="form-control" placeholder="+1-555-0000">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Department *</label>
                                    <select id="newDepartment" class="form-select" required>
                                        <option value="">Select Department</option>
                                        <option value="HR">Human Resources</option>
                                        <option value="IT">Information Technology</option>
                                        <option value="Finance">Finance</option>
                                        <option value="Marketing">Marketing</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Position *</label>
                                    <input type="text" id="newPosition" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Salary *</label>
                                    <input type="number" id="newSalary" class="form-control" min="0" step="1000" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Hire Date *</label>
                                    <input type="date" id="newHireDate" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input type="checkbox" id="newStatus" class="form-check-input" checked>
                                        <label class="form-check-label">Active Employee</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="saveNewEmployee()">
                        <i class="fas fa-save me-1"></i>Save Employee
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteEmployeeModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title"><i class="fas fa-exclamation-triangle me-2"></i>Delete Employee</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Warning!</strong> This action cannot be undone.
                    </div>
                    <p>Are you sure you want to delete this employee?</p>
                    <div class="card">
                        <div class="card-body">
                            <h6 class="card-title" id="deleteEmployeeName">Employee Name</h6>
                            <p class="card-text">
                                <strong>ID:</strong> <span id="deleteEmployeeId">EMP001</span><br>
                                <strong>Position:</strong> <span id="deleteEmployeePosition">Position</span><br>
                                <strong>Department:</strong> <span id="deleteEmployeeDepartment">Department</span>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancel
                    </button>
                    <button type="button" class="btn btn-danger" onclick="deleteEmployee()">
                        <i class="fas fa-trash me-1"></i>Delete Employee
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Employee data management with localStorage
        function getEmployeesFromStorage() {
            const storedEmployees = localStorage.getItem('employeesData');
            if (storedEmployees) {
                return JSON.parse(storedEmployees);
            }
            
            // Default employees if none in storage
            const defaultEmployees = [
                {
                    employeeId: "EMP001",
                    firstName: "John",
                    lastName: "Doe",
                    email: "john.doe@company.com",
                    phone: "+1-555-0123",
                    department: "HR",
                    position: "HR Manager",
                    salary: 75000,
                    hireDate: "2022-01-15",
                    isActive: true
                },
                {
                    employeeId: "EMP002",
                    firstName: "Jane",
                    lastName: "Smith",
                    email: "jane.smith@company.com",
                    phone: "+1-555-0124",
                    department: "IT",
                    position: "Software Developer",
                    salary: 85000,
                    hireDate: "2021-03-22",
                    isActive: true
                },
                {
                    employeeId: "EMP003",
                    firstName: "Mike",
                    lastName: "Johnson",
                    email: "mike.johnson@company.com",
                    phone: "+1-555-0125",
                    department: "Finance",
                    position: "Financial Analyst",
                    salary: 70000,
                    hireDate: "2022-07-10",
                    isActive: true
                },
                {
                    employeeId: "EMP004",
                    firstName: "Sarah",
                    lastName: "Wilson",
                    email: "sarah.wilson@company.com",
                    phone: "+1-555-0126",
                    department: "Marketing",
                    position: "Marketing Specialist",
                    salary: 65000,
                    hireDate: "2023-02-14",
                    isActive: true
                },
                {
                    employeeId: "EMP005",
                    firstName: "David",
                    lastName: "Brown",
                    email: "david.brown@company.com",
                    phone: "+1-555-0127",
                    department: "IT",
                    position: "System Administrator",
                    salary: 80000,
                    hireDate: "2021-11-30",
                    isActive: true
                }
            ];
            
            // Save default employees to localStorage
            localStorage.setItem('employeesData', JSON.stringify(defaultEmployees));
            return defaultEmployees;
        }
        
        function saveEmployeesToStorage(employeesArray) {
            localStorage.setItem('employeesData', JSON.stringify(employeesArray));
        }
        
        // Get employees from localStorage
        let employees = getEmployeesFromStorage();

        let currentEmployee = null;
        let isEditMode = false;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            
            if (!currentUser) {
                window.location.href = 'index.html';
                return;
            }

            // Set user info
            document.getElementById('userFullName').textContent = currentUser.fullName;

            // Apply theme
            applyTheme(currentUser.department);

            // Check for URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const employeeId = urlParams.get('id');
            const action = urlParams.get('action');
            const view = urlParams.get('view');

            if (view === 'all') {
                // Show all employees
                showAllEmployees();
            } else if (action === 'add') {
                // Show add employee modal if action=add
                setTimeout(() => {
                    showAddEmployeeForm();
                }, 500);
            } else if (employeeId) {
                // Search for specific employee
                document.getElementById('txtSearchEmployeeId').value = employeeId;
                searchEmployee();
            }

            // Auto-focus search box
            document.getElementById('txtSearchEmployeeId').focus();
            
            // Set default hire date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('newHireDate').value = today;
        });

        function applyTheme(department) {
            const body = document.body;
            body.className = 'themed theme-' + department.toLowerCase();
        }

        function searchEmployee() {
            const employeeId = document.getElementById('txtSearchEmployeeId').value.trim();
            
            if (!employeeId) {
                showSearchMessage('Please enter an Employee ID.', 'warning');
                return;
            }

            const employee = employees.find(emp => emp.employeeId.toUpperCase() === employeeId.toUpperCase());
            
            if (employee) {
                currentEmployee = employee;
                displayEmployee(employee);
                document.getElementById('employeeDetails').style.display = 'block';
                hideSearchMessage();
            } else {
                showSearchMessage('Employee not found. Please check the Employee ID and try again.', 'danger');
                document.getElementById('employeeDetails').style.display = 'none';
            }
        }

        function displayEmployee(employee) {
            // Basic Information
            document.getElementById('employeeId').textContent = employee.employeeId;
            document.getElementById('firstNameDisplay').textContent = employee.firstName;
            document.getElementById('lastNameDisplay').textContent = employee.lastName;
            document.getElementById('emailDisplay').textContent = employee.email;
            document.getElementById('phoneDisplay').textContent = employee.phone;
            document.getElementById('departmentDisplay').textContent = employee.department;
            document.getElementById('positionDisplay').textContent = employee.position;
            document.getElementById('salaryDisplay').textContent = '$' + employee.salary.toLocaleString();
            document.getElementById('hireDateDisplay').textContent = new Date(employee.hireDate).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });

            // Set edit form values
            document.getElementById('firstNameEdit').value = employee.firstName;
            document.getElementById('lastNameEdit').value = employee.lastName;
            document.getElementById('emailEdit').value = employee.email;
            document.getElementById('phoneEdit').value = employee.phone;
            document.getElementById('departmentEdit').value = employee.department;
            document.getElementById('positionEdit').value = employee.position;
            document.getElementById('salaryEdit').value = employee.salary;
            document.getElementById('hireDateEdit').value = employee.hireDate;
            document.getElementById('statusEdit').checked = employee.isActive;

            // Status
            const statusElement = document.getElementById('employeeStatus');
            if (employee.isActive) {
                statusElement.textContent = 'Active';
                statusElement.className = 'status-badge status-active';
            } else {
                statusElement.textContent = 'Inactive';
                statusElement.className = 'status-badge status-inactive';
            }

            // Employee initials for avatar
            const initials = (employee.firstName[0] || '') + (employee.lastName[0] || '');
            document.getElementById('employeeAvatar').textContent = initials.toUpperCase();

            // Reset edit mode
            setEditMode(false);
        }

        function toggleEditMode() {
            if (!currentEmployee) return;

            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            
            // Check if user can edit this employee (same department or admin privileges)
            if (currentUser.department !== currentEmployee.department && currentUser.username !== 'aliriza') {
                showUpdateMessage('You can only edit employees from your department.', 'warning');
                return;
            }

            setEditMode(true);
        }

        function setEditMode(editMode) {
            isEditMode = editMode;

            // Toggle display elements
            const displayElements = ['firstNameDisplay', 'lastNameDisplay', 'emailDisplay', 
                                   'phoneDisplay', 'departmentDisplay', 'positionDisplay', 
                                   'salaryDisplay', 'hireDateDisplay'];
            
            const editElements = ['firstNameEdit', 'lastNameEdit', 'emailEdit', 
                                'phoneEdit', 'departmentEdit', 'positionEdit', 
                                'salaryEdit', 'hireDateEdit', 'statusEdit', 'statusLabel'];

            displayElements.forEach(id => {
                document.getElementById(id).style.display = editMode ? 'none' : 'block';
            });

            editElements.forEach(id => {
                document.getElementById(id).style.display = editMode ? 'block' : 'none';
            });

            // Toggle buttons
            document.getElementById('btnEdit').style.display = editMode ? 'none' : 'inline-block';
            document.getElementById('btnDelete').style.display = editMode ? 'none' : 'inline-block';
            document.getElementById('btnSave').style.display = editMode ? 'inline-block' : 'none';
            document.getElementById('btnCancel').style.display = editMode ? 'inline-block' : 'none';
        }

        function saveEmployee() {
            if (!validateInput()) return;

            // Update employee object
            currentEmployee.firstName = document.getElementById('firstNameEdit').value.trim();
            currentEmployee.lastName = document.getElementById('lastNameEdit').value.trim();
            currentEmployee.email = document.getElementById('emailEdit').value.trim();
            currentEmployee.phone = document.getElementById('phoneEdit').value.trim();
            currentEmployee.department = document.getElementById('departmentEdit').value;
            currentEmployee.position = document.getElementById('positionEdit').value.trim();
            currentEmployee.salary = parseFloat(document.getElementById('salaryEdit').value);
            currentEmployee.hireDate = document.getElementById('hireDateEdit').value;
            currentEmployee.isActive = document.getElementById('statusEdit').checked;

            // Find and update in employees array
            const index = employees.findIndex(emp => emp.employeeId === currentEmployee.employeeId);
            if (index !== -1) {
                employees[index] = { ...currentEmployee };
                // Save to localStorage
                saveEmployeesToStorage(employees);
            }

            // Refresh display
            displayEmployee(currentEmployee);
            showUpdateMessage('Employee information updated successfully!', 'success');
        }

        function cancelEdit() {
            if (currentEmployee) {
                displayEmployee(currentEmployee);
                hideUpdateMessage();
            }
        }

        function validateInput() {
            const firstName = document.getElementById('firstNameEdit').value.trim();
            const lastName = document.getElementById('lastNameEdit').value.trim();
            const email = document.getElementById('emailEdit').value.trim();
            const position = document.getElementById('positionEdit').value.trim();
            const salary = parseFloat(document.getElementById('salaryEdit').value);

            if (!firstName || !lastName || !email || !position) {
                showUpdateMessage('Please fill in all required fields (First Name, Last Name, Email, Position).', 'warning');
                return false;
            }

            if (isNaN(salary) || salary < 0) {
                showUpdateMessage('Please enter a valid salary amount.', 'warning');
                return false;
            }

            return true;
        }

        function clearSearch() {
            document.getElementById('txtSearchEmployeeId').value = '';
            document.getElementById('employeeDetails').style.display = 'none';
            hideSearchMessage();
            hideUpdateMessage();
            currentEmployee = null;
            isEditMode = false;
        }

        function showSearchMessage(message, type) {
            document.getElementById('searchMessageText').textContent = message;
            document.getElementById('searchMessage').className = `alert alert-${type} mt-3`;
            document.getElementById('searchMessage').style.display = 'block';
        }

        function hideSearchMessage() {
            document.getElementById('searchMessage').style.display = 'none';
        }

        function showUpdateMessage(message, type) {
            document.getElementById('updateMessageText').textContent = message;
            document.getElementById('updateMessage').className = `alert alert-${type}`;
            document.getElementById('updateMessage').style.display = 'block';
            
            setTimeout(() => {
                hideUpdateMessage();
            }, 3000);
        }

        function hideUpdateMessage() {
            document.getElementById('updateMessage').style.display = 'none';
        }

        function changeTheme() {
            const themes = ['Default', 'HR', 'IT', 'Finance', 'Marketing'];
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            
            const themeSelection = prompt(
                'Select theme:\n1. Default (Blue)\n2. HR (Green)\n3. IT (Purple)\n4. Finance (Orange)\n5. Marketing (Pink)\n\nYour choice (1-5):',
                '1'
            );
            
            if (themeSelection && themeSelection >= 1 && themeSelection <= 5) {
                const selectedTheme = themes[themeSelection - 1];
                currentUser.selectedTheme = selectedTheme;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                applyTheme(selectedTheme);
                alert('Theme changed: ' + selectedTheme);
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('currentUser');
                window.location.href = 'index.html';
            }
        }

        // Add Employee Functions
        function showAddEmployeeForm() {
            // Reset form
            document.getElementById('addEmployeeForm').reset();
            
            // Set default values
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('newHireDate').value = today;
            document.getElementById('newStatus').checked = true;
            
            // Generate next employee ID
            const nextId = generateNextEmployeeId();
            document.getElementById('newEmployeeId').value = nextId;
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('addEmployeeModal'));
            modal.show();
        }

        function generateNextEmployeeId() {
            const maxId = employees.reduce((max, emp) => {
                const num = parseInt(emp.employeeId.replace('EMP', ''));
                return num > max ? num : max;
            }, 0);
            
            return 'EMP' + String(maxId + 1).padStart(3, '0');
        }

        function saveNewEmployee() {
            if (!validateNewEmployeeInput()) return;

            const newEmployee = {
                employeeId: document.getElementById('newEmployeeId').value.trim(),
                firstName: document.getElementById('newFirstName').value.trim(),
                lastName: document.getElementById('newLastName').value.trim(),
                email: document.getElementById('newEmail').value.trim(),
                phone: document.getElementById('newPhone').value.trim(),
                department: document.getElementById('newDepartment').value,
                position: document.getElementById('newPosition').value.trim(),
                salary: parseFloat(document.getElementById('newSalary').value),
                hireDate: document.getElementById('newHireDate').value,
                isActive: document.getElementById('newStatus').checked
            };

            // Check if employee ID already exists
            if (employees.find(emp => emp.employeeId.toUpperCase() === newEmployee.employeeId.toUpperCase())) {
                alert('Employee ID already exists. Please use a different ID.');
                return;
            }

            // Add to employees array
            employees.push(newEmployee);
            
            // Save to localStorage
            saveEmployeesToStorage(employees);

            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addEmployeeModal'));
            modal.hide();

            // Show success message
            showUpdateMessage(`Employee ${newEmployee.employeeId} added successfully!`, 'success');

            // Optionally search for the new employee
            document.getElementById('txtSearchEmployeeId').value = newEmployee.employeeId;
            searchEmployee();
        }

        function validateNewEmployeeInput() {
            const employeeId = document.getElementById('newEmployeeId').value.trim();
            const firstName = document.getElementById('newFirstName').value.trim();
            const lastName = document.getElementById('newLastName').value.trim();
            const email = document.getElementById('newEmail').value.trim();
            const department = document.getElementById('newDepartment').value;
            const position = document.getElementById('newPosition').value.trim();
            const salary = parseFloat(document.getElementById('newSalary').value);
            const hireDate = document.getElementById('newHireDate').value;

            if (!employeeId || !firstName || !lastName || !email || !department || !position || !hireDate) {
                alert('Please fill in all required fields marked with *');
                return false;
            }

            if (isNaN(salary) || salary < 0) {
                alert('Please enter a valid salary amount.');
                return false;
            }

            // More flexible email validation
            const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            if (email && !emailRegex.test(email)) {
                alert('Please enter a valid email address (example: john.doe@company.com).');
                return false;
            }

            // Check if hire date is not in future
            const today = new Date();
            const selectedDate = new Date(hireDate);
            if (selectedDate > today) {
                const confirm = window.confirm('Hire date is in the future. Do you want to continue?');
                if (!confirm) return false;
            }

            return true;
        }

        // Delete Employee Functions
        function showDeleteConfirmation() {
            if (!currentEmployee) return;

            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            
            // Check if user can delete this employee (same department or admin privileges)
            if (currentUser.department !== currentEmployee.department && currentUser.username !== 'aliriza') {
                showUpdateMessage('You can only delete employees from your department.', 'warning');
                return;
            }

            // Populate delete confirmation modal
            document.getElementById('deleteEmployeeName').textContent = 
                `${currentEmployee.firstName} ${currentEmployee.lastName}`;
            document.getElementById('deleteEmployeeId').textContent = currentEmployee.employeeId;
            document.getElementById('deleteEmployeePosition').textContent = currentEmployee.position;
            document.getElementById('deleteEmployeeDepartment').textContent = currentEmployee.department;

            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('deleteEmployeeModal'));
            modal.show();
        }

        function deleteEmployee() {
            if (!currentEmployee) return;

            // Find and remove from employees array
            const index = employees.findIndex(emp => emp.employeeId === currentEmployee.employeeId);
            if (index !== -1) {
                const deletedEmployee = employees[index];
                employees.splice(index, 1);
                
                // Save to localStorage
                saveEmployeesToStorage(employees);

                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('deleteEmployeeModal'));
                modal.hide();

                // Clear employee details
                document.getElementById('employeeDetails').style.display = 'none';
                document.getElementById('txtSearchEmployeeId').value = '';
                
                // Show success message
                showUpdateMessage(
                    `Employee ${deletedEmployee.employeeId} (${deletedEmployee.firstName} ${deletedEmployee.lastName}) has been deleted successfully.`, 
                    'success'
                );

                // Reset current employee
                currentEmployee = null;
                isEditMode = false;
                
                // Auto-hide success message after 5 seconds
                setTimeout(() => {
                    hideUpdateMessage();
                }, 5000);

                // Refresh all employees list if it's visible
                if (document.getElementById('allEmployeesList').style.display !== 'none') {
                    loadAllEmployees();
                }
            }
        }

        // All Employees List Functions
        function showAllEmployees() {
            document.getElementById('allEmployeesList').style.display = 'block';
            loadAllEmployees();
        }

        function hideAllEmployees() {
            document.getElementById('allEmployeesList').style.display = 'none';
        }

        function loadAllEmployees() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            let displayEmployees = employees.filter(emp => emp.isActive);

            // If not super admin, filter by department
            if (currentUser.username !== 'aliriza') {
                displayEmployees = displayEmployees.filter(emp => emp.department === currentUser.department);
            }

            renderEmployeeTable(displayEmployees);
        }

        function filterEmployees() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const departmentFilter = document.getElementById('departmentFilter').value;
            
            let filteredEmployees = employees.filter(emp => emp.isActive);

            // Apply department filter
            if (departmentFilter) {
                filteredEmployees = filteredEmployees.filter(emp => emp.department === departmentFilter);
            }

            // If not super admin, further filter by user's department
            if (currentUser.username !== 'aliriza') {
                filteredEmployees = filteredEmployees.filter(emp => emp.department === currentUser.department);
            }

            renderEmployeeTable(filteredEmployees);
        }

        function renderEmployeeTable(employeeList) {
            const tableBody = document.getElementById('allEmployeesTableBody');
            const countElement = document.getElementById('employeeCount');
            
            // Update count
            countElement.textContent = `${employeeList.length} Employee${employeeList.length !== 1 ? 's' : ''} Found`;

            if (employeeList.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center text-muted py-4">
                            <i class="fas fa-users fa-2x mb-2"></i><br>
                            No employees found
                        </td>
                    </tr>
                `;
                return;
            }

            tableBody.innerHTML = employeeList.map(employee => `
                <tr>
                    <td>
                        <span class="badge bg-secondary">${employee.employeeId}</span>
                    </td>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="employee-avatar-small bg-primary text-white rounded-circle me-2 d-flex align-items-center justify-content-center" 
                                 style="width: 35px; height: 35px; font-size: 0.75rem;">
                                ${(employee.firstName[0] || '') + (employee.lastName[0] || '')}
                            </div>
                            <div>
                                <div class="fw-semibold">${employee.firstName} ${employee.lastName}</div>
                                <small class="text-muted">ID: ${employee.employeeId}</small>
                            </div>
                        </div>
                    </td>
                    <td>
                        <a href="mailto:${employee.email}" class="text-decoration-none">
                            ${employee.email}
                        </a>
                    </td>
                    <td>
                        <span class="badge bg-${getDepartmentColor(employee.department)}">${employee.department}</span>
                    </td>
                    <td>${employee.position}</td>
                    <td>
                        <span class="fw-semibold text-success">$${employee.salary.toLocaleString()}</span>
                    </td>
                    <td>
                        <span class="badge bg-${employee.isActive ? 'success' : 'danger'}">
                            ${employee.isActive ? 'Active' : 'Inactive'}
                        </span>
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary btn-sm" onclick="viewEmployeeDetails('${employee.employeeId}')" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${canEditEmployee(employee) ? `
                                <button class="btn btn-outline-warning btn-sm" onclick="editEmployeeInline('${employee.employeeId}')" title="Quick Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                            ` : ''}
                            ${canDeleteEmployee(employee) ? `
                                <button class="btn btn-outline-danger btn-sm" onclick="deleteEmployeeFromList('${employee.employeeId}')" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function getDepartmentColor(department) {
            const colors = {
                'HR': 'success',
                'IT': 'primary', 
                'Finance': 'warning',
                'Marketing': 'danger',
                'Default': 'info'
            };
            return colors[department] || 'secondary';
        }

        function canEditEmployee(employee) {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            return currentUser.department === employee.department || currentUser.username === 'aliriza';
        }

        function canDeleteEmployee(employee) {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            return currentUser.department === employee.department || currentUser.username === 'aliriza';
        }

        function viewEmployeeDetails(employeeId) {
            document.getElementById('txtSearchEmployeeId').value = employeeId;
            hideAllEmployees();
            searchEmployee();
        }

        function editEmployeeInline(employeeId) {
            viewEmployeeDetails(employeeId);
            setTimeout(() => {
                toggleEditMode();
            }, 500);
        }

        function deleteEmployeeFromList(employeeId) {
            const employee = employees.find(emp => emp.employeeId === employeeId);
            if (employee) {
                currentEmployee = employee;
                showDeleteConfirmation();
            }
        }

        // Real-time email validation
        function initializeEmailValidation() {
            const emailInput = document.getElementById('newEmail');
            if (emailInput) {
                emailInput.addEventListener('input', function() {
                    const email = this.value.trim();
                    const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
                    
                    if (email && !emailRegex.test(email)) {
                        this.classList.add('is-invalid');
                        this.classList.remove('is-valid');
                    } else if (email) {
                        this.classList.add('is-valid');
                        this.classList.remove('is-invalid');
                    } else {
                        this.classList.remove('is-invalid', 'is-valid');
                    }
                });
            }
        }

        // Enter key support for search
        document.getElementById('txtSearchEmployeeId').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchEmployee();
            }
        });

        // Initialize email validation when modal is shown
        document.getElementById('addEmployeeModal').addEventListener('shown.bs.modal', function() {
            initializeEmailValidation();
        });
    </script>
</body>
</html>